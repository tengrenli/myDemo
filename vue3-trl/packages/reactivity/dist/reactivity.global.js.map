{"version":3,"file":"reactivity.global.js","sources":["../../shared/src/index.ts","../src/baseHandlers.ts","../src/reactive.ts"],"sourcesContent":["export const isObject = value => typeof value == 'object' && value !== null\nexport const extend = Object.assign\nexport const isArray = Array.isArray\nexport const isFunction = value => typeof value == 'function'\nexport const isNumber = value => typeof value == 'number'\nexport const isString = value => typeof value === 'string'\nexport const isIntegerKey = key => parseInt(key) + '' === key\n\nlet hasOwnpRroperty = Object.prototype.hasOwnProperty\nexport const hasOwn = (target, key) => hasOwnpRroperty.call(target, key)\n\nexport const hasChanged = (oldValue, value) => oldValue !== value\n","import {\n  extend,\n  hasChanged,\n  hasOwn,\n  isArray,\n  isIntegerKey,\n  isObject\n} from '@vue/shared'\nimport { reactive, readonly } from './reactive'\nconst mutableHandlersGet = createGetter()\nconst mutableHandlersSet = createSetter()\n\nconst shallowReactiveHandlersGet = createGetter(false, true)\nconst shallowReactiveHandlersSet = createSetter(true)\n\nconst readonlyHandlersGet = createGetter(true) // 只读 非浅 不能设置新属性\n\nconst shallowReadonlyHandlersGet = createGetter(true, true)\n\nconst readOnlySet = {\n  set: (target, key) => {\n    console.warn(`set on key ${key} failed`)\n  }\n}\n// 响应\nexport const mutableHandlers = {\n  get: mutableHandlersGet,\n  set: mutableHandlersSet\n}\n\nexport const shallowReactiveHandlers = {\n  get: shallowReactiveHandlersGet,\n  set: shallowReactiveHandlersSet\n}\n\nexport const readonlyHandlers = extend(\n  {\n    get: readonlyHandlersGet\n  },\n  readOnlySet\n)\n\nexport const shallowReadonlyHandlers = extend(\n  {\n    get: shallowReadonlyHandlersGet\n  },\n  readOnlySet\n)\n\nfunction createGetter (isReadonly = false, shallow = false) {\n  return function (target, key, receiver) {\n    const res = Reflect.get(target, key, receiver)\n    if (!isReadonly) {\n      //收集依赖\n    }\n\n    if (shallow) {\n      return res\n    }\n\n    if (isObject(res)) {\n      return isReadonly ? readonly(res) : reactive(res)\n    }\n    return res\n  }\n}\nfunction createSetter (shallow = false) {\n  return function (target, key, receiver) {\n    const res = Reflect.set(target, key, receiver)\n    return res\n  }\n}\n\n// reactivity readonly  shallowReactive  shallowReadOnly\n","import { isObject } from '@vue/shared'\nimport {\n  mutableHandlers,\n  shallowReactiveHandlers,\n  readonlyHandlers,\n  shallowReadonlyHandlers\n} from './baseHandlers'\nexport function reactive (target: any) {\n  return createReactiveObject(target, false, mutableHandlers)\n}\n\nexport function shallowReactive (target: any) {\n  return createReactiveObject(target, false, shallowReactiveHandlers)\n}\n\nexport function shallowReadonly (target: any) {\n  return createReactiveObject(target, true, shallowReadonlyHandlers)\n}\n\nexport function readonly (target: any) {\n  return createReactiveObject(target, true, readonlyHandlers)\n}\n\nconst reactiveMap = new WeakMap()\nconst readonlyMap = new WeakMap()\n/**\n * target 目标\n * isReadonly 是否为只读\n * baseHandler 代理函数\n */\nfunction createReactiveObject (target, isReadonly, baseHandler) {\n  if (!isObject(target)) {\n    // 非对象直接返回\n    return target\n  }\n  const proxyMap = isReadonly ? readonlyMap : reactiveMap\n\n  const isExitProxy = proxyMap.get(target) // 是否已代理\n  if (isExitProxy) {\n    return isExitProxy\n  }\n\n  const proxy = new Proxy(target, baseHandler)\n  proxyMap.set(target, proxy)\n  return proxy\n}\n"],"names":[],"mappings":";;;EAAO,MAAM,QAAQ,GAAG,KAAK,IAAI,OAAO,KAAK,IAAI,QAAQ,IAAI,KAAK,KAAK,IAAI,CAAA;EACpE,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM;;ECQnC,MAAM,kBAAkB,GAAG,YAAY,EAAE,CAAA;EACzC,MAAM,kBAAkB,GAAG,YAAY,EAAE,CAAA;EAEzC,MAAM,0BAA0B,GAAG,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,CAAA;EAC5D,MAAM,0BAA0B,GAAG,YAAY,CAAC,IAAI,CAAC,CAAA;EAErD,MAAM,mBAAmB,GAAG,YAAY,CAAC,IAAI,CAAC,CAAA;EAE9C,MAAM,0BAA0B,GAAG,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;EAE3D,MAAM,WAAW,GAAG;MAClB,GAAG,EAAE,CAAC,MAAM,EAAE,GAAG;UACf,OAAO,CAAC,IAAI,CAAC,cAAc,GAAG,SAAS,CAAC,CAAA;OACzC;GACF,CAAA;EACD;EACO,MAAM,eAAe,GAAG;MAC7B,GAAG,EAAE,kBAAkB;MACvB,GAAG,EAAE,kBAAkB;GACxB,CAAA;EAEM,MAAM,uBAAuB,GAAG;MACrC,GAAG,EAAE,0BAA0B;MAC/B,GAAG,EAAE,0BAA0B;GAChC,CAAA;EAEM,MAAM,gBAAgB,GAAG,MAAM,CACpC;MACE,GAAG,EAAE,mBAAmB;GACzB,EACD,WAAW,CACZ,CAAA;EAEM,MAAM,uBAAuB,GAAG,MAAM,CAC3C;MACE,GAAG,EAAE,0BAA0B;GAChC,EACD,WAAW,CACZ,CAAA;EAED,SAAS,YAAY,CAAE,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK;MACxD,OAAO,UAAU,MAAM,EAAE,GAAG,EAAE,QAAQ;UACpC,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;UAK9C,IAAI,OAAO,EAAE;cACX,OAAO,GAAG,CAAA;WACX;UAED,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;cACjB,OAAO,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAA;WAClD;UACD,OAAO,GAAG,CAAA;OACX,CAAA;EACH,CAAC;EACD,SAAS,YAAY,CAAE,OAAO,GAAG,KAAK;MACpC,OAAO,UAAU,MAAM,EAAE,GAAG,EAAE,QAAQ;UACpC,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAA;UAC9C,OAAO,GAAG,CAAA;OACX,CAAA;EACH,CAAC;EAED;;WClEgB,QAAQ,CAAE,MAAW;MACnC,OAAO,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,eAAe,CAAC,CAAA;EAC7D,CAAC;WAEe,eAAe,CAAE,MAAW;MAC1C,OAAO,oBAAoB,CAAC,MAAM,EAAE,KAAK,EAAE,uBAAuB,CAAC,CAAA;EACrE,CAAC;WAEe,eAAe,CAAE,MAAW;MAC1C,OAAO,oBAAoB,CAAC,MAAM,EAAE,IAAI,EAAE,uBAAuB,CAAC,CAAA;EACpE,CAAC;WAEe,QAAQ,CAAE,MAAW;MACnC,OAAO,oBAAoB,CAAC,MAAM,EAAE,IAAI,EAAE,gBAAgB,CAAC,CAAA;EAC7D,CAAC;EAED,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAA;EACjC,MAAM,WAAW,GAAG,IAAI,OAAO,EAAE,CAAA;EACjC;;;;;EAKA,SAAS,oBAAoB,CAAE,MAAM,EAAE,UAAU,EAAE,WAAW;MAC5D,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE;;UAErB,OAAO,MAAM,CAAA;OACd;MACD,MAAM,QAAQ,GAAG,UAAU,GAAG,WAAW,GAAG,WAAW,CAAA;MAEvD,MAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;MACxC,IAAI,WAAW,EAAE;UACf,OAAO,WAAW,CAAA;OACnB;MAED,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,WAAW,CAAC,CAAA;MAC5C,QAAQ,CAAC,GAAG,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;MAC3B,OAAO,KAAK,CAAA;EACd;;;;;;;;;;;;;;;"}